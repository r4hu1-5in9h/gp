
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>solution</title><meta name="generator" content="MATLAB 9.1"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-05-30"><meta name="DC.source" content="solution.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Visualize tilted loss</a></li><li><a href="#2">Visualize mean gasoline demand</a></li><li><a href="#3">Compare optimization methods on subset of data</a></li><li><a href="#4">Implement chosen method on full data set</a></li><li><a href="#5">Visualize quantiles of gasoline demand</a></li><li><a href="#8">loss_vis.m</a></li><li><a href="#10">prelim.m</a></li><li><a href="#12">save_quantile.m</a></li><li><a href="#14">plot_quantile.m</a></li></ul></div><h2 id="1">Visualize tilted loss</h2><pre class="codeinput">clear;
loss_vis;
</pre><img vspace="5" hspace="5" src="solution_01.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="solution_02.png" style="width:560px;height:420px;" alt=""> <h2 id="2">Visualize mean gasoline demand</h2><pre class="codeinput">prelim;
</pre><img vspace="5" hspace="5" src="solution_03.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="solution_04.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="solution_05.png" style="width:560px;height:420px;" alt=""> <h2 id="3">Compare optimization methods on subset of data</h2><pre class="codeinput">clear;
startup;
load(<span class="string">'../data/data_BHP2.mat'</span>);
data=[log_q log_p log_y];

n_obs=100;
rng(3);
sample=datasample(data,n_obs,<span class="string">'Replace'</span>,false);
y=sample(:,1);
x1=sample(:,2);
x2=sample(:,3);

len=100;
quantiles = [0.25 0.50 0.75];
optimizers = {<span class="string">'sd'</span>,<span class="string">'bb'</span>,<span class="string">'pr'</span>,<span class="string">'lbfgs'</span>};

<span class="keyword">for</span> idq = 1:length(quantiles)

    quantileToPredict=quantiles(idq);

    tic;

    figure;
    <span class="keyword">for</span> ido = 1:length(optimizers)

        optimizer=optimizers{ido};
        fprintf(<span class="string">'quantile: %3.2f optimizer: %s\n'</span>,quantileToPredict,optimizer);

        [~,~,~,~,~,output]=save_quantile(quantileToPredict,len,optimizer,x1,x2,y);

        param_path=output.trace.param_path;
        n_iter=output.iterations;

        subplot(2,2,ido);
        scatter3(param_path(1,:),param_path(2,:),param_path(4,:),<span class="string">'filled'</span>);
        line(param_path(1,:),param_path(2,:),param_path(4,:));
        title(strcat(optimizers{ido},<span class="string">': '</span>,num2str(n_iter)));
        xlabel(<span class="string">'log(\theta_{price})'</span>);
        ylabel(<span class="string">'log(\theta_{income})'</span>);
        zlabel(<span class="string">'log(\sigma)'</span>);
        view(30,30);

    <span class="keyword">end</span>

    toc;

<span class="keyword">end</span>
</pre><pre class="codeoutput">executing gpml startup script...
quantile: 0.25 optimizer: sd
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     6.92700e-03     1.69932e+02     6.62074e+01
         2          3     1.97241e-02     1.11917e+02     1.24962e+01
         3          5     2.70896e-02     1.11399e+02     1.92385e+01
         4          6     2.54993e-03     1.10458e+02     1.53123e+01
         5          7     6.96442e-03     1.09062e+02     6.09225e+00
         6          9     1.89755e-02     1.08379e+02     5.01653e+00
         7         10     2.56888e-02     1.07887e+02     7.51618e+00
         8         11     1.26733e-02     1.07328e+02     4.25269e+00
         9         12     5.06366e-02     1.06564e+02     5.75489e+00
        10         14     1.47653e-02     1.06211e+02     3.54331e+00
        11         15     3.71270e-02     1.05921e+02     6.20252e+00
        12         16     1.19583e-02     1.05600e+02     2.99673e+00
        13         17     6.24450e-02     1.05183e+02     4.39722e+00
        14         19     1.28502e-02     1.05026e+02     1.97415e+00
        15         20     5.76427e-02     1.04928e+02     4.79466e+00
        16         21     7.78251e-03     1.04799e+02     1.27165e+00
        17         23     2.24187e-02     1.04758e+02     1.48974e+00
        18         24     2.07161e-02     1.04726e+02     1.54831e+00
        19         25     1.69102e-02     1.04696e+02     1.01617e+00
        20         26     2.65155e-02     1.04674e+02     1.62652e+00
        21         27     1.23555e-02     1.04649e+02     7.60127e-01
        22         28     4.86995e-02     1.04615e+02     1.26437e+00
        23         30     1.42526e-02     1.04599e+02     5.64560e-01
        24         31     3.77119e-02     1.04585e+02     1.34472e+00
        25         32     1.18990e-02     1.04570e+02     4.64679e-01
        26         33     5.78515e-02     1.04551e+02     1.02368e+00
        27         35     1.34847e-02     1.04541e+02     3.75860e-01
        28         36     4.34252e-02     1.04533e+02     1.06699e+00
        29         37     1.16942e-02     1.04524e+02     3.51461e-01
        30         38     6.26418e-02     1.04512e+02     7.90196e-01
        31         40     1.34242e-02     1.04506e+02     3.20308e-01
        32         41     4.37412e-02     1.04501e+02     8.17436e-01
        33         42     1.19749e-02     1.04496e+02     2.98469e-01
        34         43     5.91351e-02     1.04489e+02     6.78292e-01
        35         44     2.25396e-02     1.04488e+02     8.26572e-01
        36         45     4.40623e-03     1.04485e+02     4.66626e-01
        37         46     1.71463e-02     1.04482e+02     3.19376e-01
        38         47     2.40900e-02     1.04480e+02     4.39051e-01
        39         48     1.48792e-02     1.04478e+02     2.48394e-01
        40         49     3.25695e-02     1.04475e+02     4.49647e-01
        41         50     1.61539e-02     1.04473e+02     2.63925e-01
        42         51     2.70239e-02     1.04472e+02     4.39270e-01
        43         52     1.22188e-02     1.04470e+02     2.21659e-01
        44         53     4.48557e-02     1.04467e+02     3.04288e-01
        45         55     1.73941e-02     1.04465e+02     2.15248e-01
        46         56     2.50792e-02     1.04464e+02     3.16773e-01
        47         57     1.63418e-02     1.04463e+02     1.93554e-01
        48         58     2.73408e-02     1.04462e+02     3.24939e-01
        49         59     1.49069e-02     1.04460e+02     1.83097e-01
        50         60     3.25525e-02     1.04459e+02     3.33544e-01
        51         61     1.47593e-02     1.04458e+02     1.72109e-01
        52         62     3.35110e-02     1.04457e+02     3.46134e-01
        53         63     1.19636e-02     1.04456e+02     1.62222e-01
        54         64     4.98543e-02     1.04455e+02     2.39833e-01
        55         66     1.60688e-02     1.04454e+02     1.48636e-01
        56         67     2.83021e-02     1.04453e+02     2.47568e-01
        57         68     1.51532e-02     1.04452e+02     1.40567e-01
        58         69     3.15542e-02     1.04452e+02     2.54903e-01
        59         70     1.40167e-02     1.04451e+02     1.32450e-01
        60         71     3.73264e-02     1.04450e+02     2.57570e-01
        61         72     1.44447e-02     1.04450e+02     1.23835e-01
        62         73     3.57246e-02     1.04449e+02     2.72403e-01
        63         74     9.83345e-03     1.04449e+02     1.16684e-01
        64         76     5.76899e-01     1.04443e+02     4.83360e-01
        65         78     1.02818e-02     1.04441e+02     3.19236e-02
        66         79     1.00000e+00     1.04441e+02     3.24690e-01
        67         80     2.04930e-03     1.04441e+02     2.59484e-01
        68         81     5.76722e-03     1.04441e+02     1.12691e-01
        69         83     1.03223e-02     1.04441e+02     1.21611e-02
        70         85     1.58833e-01     1.04441e+02     2.13444e-02
        71         87     1.08771e-02     1.04441e+02     5.11222e-03
        72         88     1.63261e-01     1.04441e+02     2.19932e-02
        73         89     7.80121e-03     1.04441e+02     5.13978e-03
        74         91     1.73389e-02     1.04441e+02     3.69489e-03
        75         92     2.53998e-02     1.04441e+02     5.39088e-03
        76         93     1.62112e-02     1.04441e+02     3.50757e-03
        77         94     2.71412e-02     1.04441e+02     5.32638e-03
        78         95     1.57759e-02     1.04441e+02     3.32107e-03
        79         96     2.93635e-02     1.04441e+02     5.52577e-03
        80         97     1.41485e-02     1.04441e+02     3.14365e-03
        81         98     3.62917e-02     1.04441e+02     5.54644e-03
        82         99     1.55589e-02     1.04441e+02     2.94313e-03
        83        100     2.98034e-02     1.04441e+02     5.65579e-03
        84        101     1.06793e-02     1.04441e+02     2.79438e-03
        85        103     2.92340e-01     1.04441e+02     7.72538e-03
        86        105     1.09830e-02     1.04441e+02     1.75736e-03
        87        106     1.44962e-01     1.04441e+02     7.92970e-03
        88        107     8.65546e-03     1.04441e+02     1.42981e-03
        89        109     3.18730e-02     1.04441e+02     2.51976e-03
        90        110     1.60385e-02     1.04441e+02     1.45660e-03
        91        111     2.70788e-02     1.04441e+02     2.40495e-03
        92        112     1.15795e-02     1.04441e+02     1.29031e-03
        93        113     4.49814e-02     1.04441e+02     1.22364e-03
        94        115     2.78485e-02     1.04441e+02     1.97236e-03
        95        116     1.68624e-02     1.04441e+02     1.28805e-03
        96        117     2.04975e-02     1.04441e+02     1.31420e-03
        97        118     2.83704e-02     1.04441e+02     2.33791e-03
        98        119     8.39674e-03     1.04441e+02     1.08308e-03
        99        120     4.20466e-02     1.04441e+02     1.28694e-03
       100        122     1.83378e-02     1.04441e+02     1.02453e-03
Reached Maximum Number of Iterations
quantile: 0.25 optimizer: bb
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     6.92641e-03     1.69932e+02     6.62065e+01
         2          3     1.00000e+00     1.12265e+02     1.62592e+01
         3          4     1.00000e+00     1.10486e+02     1.13394e+01
         4          5     1.00000e+00     1.09284e+02     5.47587e+00
         5          6     1.00000e+00     1.08838e+02     5.20040e+00
         6          7     1.00000e+00     1.07204e+02     4.17414e+00
         7          8     1.00000e+00     1.05327e+02     2.60681e+00
         8          9     1.00000e+00     1.06899e+02     1.91811e+01
         9         10     1.00000e+00     1.04735e+02     1.37867e+00
        10         11     1.00000e+00     1.04709e+02     9.34958e-01
        11         12     1.00000e+00     1.04696e+02     8.89478e-01
        12         13     1.00000e+00     1.04663e+02     7.73757e-01
        13         14     1.00000e+00     1.04508e+02     3.71447e-01
        14         15     1.00000e+00     1.04585e+02     4.78328e+00
        15         16     1.00000e+00     1.04465e+02     4.55774e-01
        16         17     1.00000e+00     1.04463e+02     2.21012e-01
        17         18     1.00000e+00     1.04462e+02     2.17227e-01
        18         19     1.00000e+00     1.04459e+02     1.94369e-01
        19         20     1.00000e+00     1.04444e+02     8.23227e-02
        20         21     1.00000e+00     1.04467e+02     2.15529e+00
        21         22     1.00000e+00     1.04443e+02     3.79922e-01
        22         23     1.00000e+00     1.04442e+02     1.12343e-01
        23         24     1.00000e+00     1.04442e+02     1.04151e-01
        24         25     1.00000e+00     1.04441e+02     2.28272e-02
        25         26     1.00000e+00     1.04441e+02     1.28516e-02
        26         27     1.00000e+00     1.04441e+02     4.97931e-02
        27         28     1.00000e+00     1.04441e+02     1.37671e-02
        28         29     1.00000e+00     1.04441e+02     1.02200e-02
        29         30     1.00000e+00     1.04441e+02     1.00974e-02
        30         31     1.00000e+00     1.04441e+02     2.25395e-04
        31         32     1.00000e+00     1.04441e+02     1.07742e-02
        32         33     1.00000e+00     1.04441e+02     1.37584e-03
        33         34     1.00000e+00     1.04441e+02     4.87735e-04
        34         35     1.00000e+00     1.04441e+02     4.54137e-04
Function Value changing by less than progTol
quantile: 0.25 optimizer: pr
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          3     2.42660e-02     1.10010e+02     9.68008e+00
         2          5     6.79301e-01     1.09105e+02     5.47511e+00
         3          7     2.25737e+00     1.08315e+02     1.36338e+01
         4          9     1.89697e+00     1.06837e+02     1.89761e+01
         5         12     1.76259e+00     1.04575e+02     1.34540e+00
         6         14     3.47946e+00     1.04559e+02     4.14813e-01
         7         16     5.56664e+00     1.04552e+02     1.00163e+00
         8         20     5.26304e+00     1.04459e+02     6.43786e-01
         9         22     2.70475e-02     1.04458e+02     6.54908e-01
        10         24     9.98181e-03     1.04458e+02     6.71112e-01
        11         27     6.01459e-01     1.04450e+02     5.27776e-01
        12         29     1.37363e+00     1.04442e+02     2.55546e-01
        13         31     1.60793e+00     1.04441e+02     4.97424e-02
        14         33     2.11339e+00     1.04441e+02     1.42627e-01
        15         34     1.00000e+00     1.04441e+02     1.05483e-01
        16         35     1.00000e+00     1.04441e+02     1.22130e-02
        17         36     1.00000e+00     1.04441e+02     5.07944e-03
        18         37     1.00000e+00     1.04441e+02     5.31047e-04
        19         38     1.00000e+00     1.04441e+02     1.20495e-04
Directional Derivative below progTol
quantile: 0.25 optimizer: lbfgs
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     6.92701e-03     1.69932e+02     6.62056e+01
         2          4     4.38368e-01     1.18199e+02     3.12395e+01
         3          5     1.00000e+00     1.13090e+02     1.32632e+01
         4          6     1.00000e+00     1.10753e+02     7.02385e+00
         5          7     1.00000e+00     1.08502e+02     4.93483e+00
         6          8     1.00000e+00     1.07004e+02     4.21204e+00
         7          9     1.00000e+00     1.04698e+02     2.32458e+00
         8         10     1.00000e+00     1.04499e+02     4.34701e-01
         9         11     1.00000e+00     1.04472e+02     2.78264e-01
        10         12     1.00000e+00     1.04458e+02     3.19004e-01
        11         13     1.00000e+00     1.04445e+02     2.39175e-01
        12         14     1.00000e+00     1.04441e+02     6.42585e-02
        13         15     1.00000e+00     1.04441e+02     7.46888e-03
        14         16     1.00000e+00     1.04441e+02     4.81469e-03
        15         17     1.00000e+00     1.04441e+02     6.21710e-03
        16         18     1.00000e+00     1.04441e+02     1.57778e-03
        17         19     1.00000e+00     1.04441e+02     1.28338e-04
Directional Derivative below progTol
Elapsed time is 10.527030 seconds.
quantile: 0.50 optimizer: sd
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     6.17202e-03     1.55419e+02     6.19404e+01
         2          3     2.08135e-02     1.08405e+02     2.74476e+01
         3          5     1.27811e-02     1.04860e+02     9.36339e+00
         4          7     1.53568e-02     1.03829e+02     4.85636e+00
         5          8     4.07018e-02     1.03357e+02     1.17244e+01
         6          9     6.04213e-03     1.02636e+02     5.41639e+00
         7         11     1.62081e-02     1.02250e+02     3.55111e+00
         8         12     3.09788e-02     1.01928e+02     5.99346e+00
         9         13     1.29260e-02     1.01568e+02     3.35593e+00
        10         14     4.67855e-02     1.01071e+02     4.92433e+00
        11         15     2.70399e-02     1.00944e+02     8.32812e+00
        12         16     3.13102e-03     1.00725e+02     5.58424e+00
        13         17     1.01611e-02     1.00453e+02     3.15131e+00
        14         18     4.76562e-02     9.99378e+01     2.77927e+00
        15         19     1.11270e-01     9.92508e+01     4.90674e+00
        16         21     1.18925e-02     9.90858e+01     1.53387e+00
        17         22     8.50569e-02     9.89672e+01     5.20178e+00
        18         23     8.11581e-03     9.88145e+01     1.17706e+00
        19         25     2.54862e-02     9.87691e+01     1.77429e+00
        20         26     1.75517e-02     9.87274e+01     1.31394e+00
        21         27     2.31405e-02     9.86898e+01     1.67943e+00
        22         28     1.63344e-02     9.86525e+01     1.04403e+00
        23         29     2.69111e-02     9.86173e+01     1.72696e+00
        24         30     1.54029e-02     9.85823e+01     9.14442e-01
        25         31     2.96638e-02     9.85493e+01     1.76410e+00
        26         32     1.45264e-02     9.85162e+01     8.59250e-01
        27         33     3.32885e-02     9.84839e+01     1.78708e+00
        28         34     1.43697e-02     9.84524e+01     8.14657e-01
        29         35     3.43189e-02     9.84237e+01     1.82858e+00
        30         36     1.26633e-02     9.83931e+01     7.80224e-01
        31         37     4.41448e-02     9.83546e+01     1.59954e+00
        32         38     2.11608e-02     9.83346e+01     1.74115e+00
        33         39     9.82863e-03     9.83088e+01     7.37666e-01
        34         41     4.96631e-01     9.79170e+01     3.36228e+00
        35         43     1.05618e-02     9.78544e+01     6.65784e-01
        36         44     1.83177e-01     9.77977e+01     3.46796e+00
        37         45     8.97716e-03     9.77333e+01     6.69401e-01
        38         47     6.47676e-02     9.77101e+01     1.79360e+00
        39         48     1.21544e-02     9.76870e+01     6.72324e-01
        40         49     6.49008e-02     9.76651e+01     1.83827e+00
        41         50     1.10085e-02     9.76414e+01     6.74427e-01
        42         51     7.79856e-02     9.76003e+01     9.54545e-01
        43         53     1.65757e-02     9.75879e+01     6.75656e-01
        44         54     2.62635e-02     9.75757e+01     9.60043e-01
        45         55     1.64235e-02     9.75633e+01     6.75433e-01
        46         56     2.66581e-02     9.75511e+01     9.67654e-01
        47         57     1.62430e-02     9.75388e+01     6.75142e-01
        48         58     2.71789e-02     9.75266e+01     9.76408e-01
        49         59     1.61150e-02     9.75144e+01     6.74386e-01
        50         60     2.75240e-02     9.75022e+01     9.83710e-01
        51         61     1.59339e-02     9.74900e+01     6.73168e-01
        52         62     2.80730e-02     9.74779e+01     9.91962e-01
        53         63     1.58080e-02     9.74657e+01     6.71570e-01
        54         64     2.84667e-02     9.74536e+01     9.99456e-01
        55         65     1.56232e-02     9.74415e+01     6.69381e-01
        56         66     2.91045e-02     9.74294e+01     1.00817e+00
        57         67     1.55073e-02     9.74173e+01     6.66706e-01
        58         68     2.94930e-02     9.74054e+01     1.01557e+00
        59         69     1.52918e-02     9.73934e+01     6.63602e-01
        60         70     3.03214e-02     9.73814e+01     1.02369e+00
        61         71     1.52588e-02     9.73694e+01     6.59886e-01
        62         72     3.04497e-02     9.73577e+01     1.03154e+00
        63         73     1.48632e-02     9.73458e+01     6.55713e-01
        64         74     3.21051e-02     9.73337e+01     1.03648e+00
        65         75     1.53017e-02     9.73219e+01     6.50807e-01
        66         76     3.02771e-02     9.73108e+01     1.04450e+00
        67         77     1.39027e-02     9.72991e+01     6.45851e-01
        68         78     3.64082e-02     9.72855e+01     9.98094e-01
        69         79     1.83763e-02     9.72748e+01     8.11962e-01
        70         80     1.86995e-02     9.72649e+01     6.89938e-01
        71         81     2.07850e-02     9.72552e+01     7.26926e-01
        72         82     1.93247e-02     9.72456e+01     6.62395e-01
        73         83     2.11061e-02     9.72360e+01     7.18879e-01
        74         84     1.94000e-02     9.72266e+01     6.60560e-01
        75         85     2.09713e-02     9.72173e+01     7.07940e-01
        76         86     1.95074e-02     9.72080e+01     6.57866e-01
        77         87     2.08545e-02     9.71989e+01     6.97619e-01
        78         88     1.96028e-02     9.71898e+01     6.55072e-01
        79         89     2.07266e-02     9.71808e+01     6.86533e-01
        80         90     1.97105e-02     9.71720e+01     6.52079e-01
        81         91     2.05963e-02     9.71632e+01     6.74792e-01
        82         92     1.98476e-02     9.71546e+01     6.50188e-01
        83         93     2.04348e-02     9.71460e+01     6.62422e-01
        84         94     1.99943e-02     9.71375e+01     6.47702e-01
        85         95     2.02854e-02     9.71291e+01     6.50459e-01
        86         96     2.01400e-02     9.71208e+01     6.45463e-01
        87         97     2.01145e-02     9.71126e+01     6.37117e-01
        88         98     2.03318e-02     9.71045e+01     6.44182e-01
        89         99     1.99187e-02     9.70965e+01     6.23215e-01
        90        100     2.05481e-02     9.70886e+01     6.43508e-01
        91        101     1.96999e-02     9.70808e+01     6.08910e-01
        92        102     2.07821e-02     9.70731e+01     6.42875e-01
        93        103     1.94714e-02     9.70655e+01     5.93692e-01
        94        104     2.10701e-02     9.70580e+01     6.43764e-01
        95        105     1.91961e-02     9.70505e+01     5.76971e-01
        96        106     2.14229e-02     9.70432e+01     6.45604e-01
        97        107     1.89055e-02     9.70359e+01     5.59885e-01
        98        108     2.18232e-02     9.70287e+01     6.48686e-01
        99        109     1.85774e-02     9.70216e+01     5.41702e-01
       100        110     2.22929e-02     9.70146e+01     6.52650e-01
Reached Maximum Number of Iterations
quantile: 0.50 optimizer: bb
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     6.17207e-03     1.55419e+02     6.19386e+01
         2          3     1.00000e+00     1.10073e+02     1.99293e+01
         3          4     1.00000e+00     1.06173e+02     1.67597e+01
         4          5     1.00000e+00     1.04264e+02     5.18101e+00
         5          6     1.00000e+00     1.03789e+02     4.81566e+00
         6          7     1.00000e+00     1.03297e+02     4.39103e+00
         7          8     1.00000e+00     1.01569e+02     3.32565e+00
         8          9     1.00000e+00     1.00158e+02     4.07301e+00
         9         10     1.00000e+00     9.99652e+01     3.96115e+00
        10         11     1.00000e+00     9.97953e+01     2.63029e+00
        11         12     1.00000e+00     9.97101e+01     2.52894e+00
        12         13     1.00000e+00     9.85022e+01     7.71090e-01
        13         14     1.00000e+00     9.82181e+01     3.90781e+00
        14         15     1.00000e+00     9.83242e+01     6.69640e+00
        15         16     1.00000e+00     9.80961e+01     7.00568e-01
        16         17     1.00000e+00     9.80857e+01     6.97908e-01
        17         18     1.00000e+00     9.80676e+01     6.93693e-01
        18         19     1.00000e+00     9.78771e+01     6.61014e-01
        19         20     1.00000e+00     9.77403e+01     1.53445e+00
        20         21     1.00000e+00     9.77213e+01     6.74303e-01
        21         22     1.00000e+00     9.77132e+01     6.74084e-01
        22         23     1.00000e+00     9.77067e+01     6.74232e-01
        23         24     1.00000e+00     9.74463e+01     6.64221e-01
        24         25     1.00000e+00     9.67424e+01     3.28813e-01
        25         27     1.84194e-02     9.67382e+01     7.16115e-01
        26         28     1.00000e+00     9.67342e+01     3.19998e-01
        27         29     1.00000e+00     9.67328e+01     3.18485e-01
        28         30     1.00000e+00     9.67238e+01     3.08664e-01
        29         31     1.00000e+00     9.65671e+01     1.22851e-01
        30         32     1.00000e+00     9.72472e+01     1.21158e+01
        31         33     1.00000e+00     9.65649e+01     1.06138e+00
        32         34     1.00000e+00     9.65573e+01     4.12292e-01
        33         35     1.00000e+00     9.65553e+01     4.01978e-01
        34         36     1.00000e+00     9.65513e+01     3.80151e-01
        35         37     1.00000e+00     9.65165e+01     7.68851e-02
        36         38     1.00000e+00     9.65217e+01     1.27274e+00
        37         39     1.00000e+00     9.65134e+01     7.47130e-02
        38         40     1.00000e+00     9.65133e+01     7.46773e-02
        39         41     1.00000e+00     9.65133e+01     7.45765e-02
        40         42     1.00000e+00     9.65098e+01     6.92604e-02
        41         43     1.00000e+00     9.64891e+01     3.53388e-02
        42         44     1.00000e+00     9.71058e+01     1.13325e+01
        43         45     1.00000e+00     9.65035e+01     4.29820e-01
        44         46     1.00000e+00     9.65016e+01     3.10098e-01
        45         47     1.00000e+00     9.65006e+01     3.01125e-01
        46         48     1.00000e+00     9.64959e+01     2.54236e-01
        47         49     1.00000e+00     9.64834e+01     6.14617e-02
        48         50     1.00000e+00     9.65062e+01     2.12375e+00
        49         51     1.00000e+00     9.64831e+01     2.30618e-02
        50         52     1.00000e+00     9.64831e+01     2.30622e-02
        51         53     1.00000e+00     9.64831e+01     2.30526e-02
        52         54     1.00000e+00     9.64829e+01     2.26897e-02
        53         55     1.00000e+00     9.64823e+01     2.15063e-02
        54         56     1.00000e+00     9.64842e+01     1.17259e+00
        55         57     1.00000e+00     9.64776e+01     2.57997e-01
        56         58     1.00000e+00     9.64773e+01     1.16118e-02
        57         59     1.00000e+00     9.64773e+01     1.16114e-02
        58         60     1.00000e+00     9.64773e+01     1.16095e-02
        59         61     1.00000e+00     9.64772e+01     1.15452e-02
        60         62     1.00000e+00     9.64771e+01     1.14247e-02
        61         63     1.00000e+00     9.64771e+01     5.29019e-02
        62         64     1.00000e+00     9.64771e+01     1.12936e-02
        63         65     1.00000e+00     9.64771e+01     1.12911e-02
        64         66     1.00000e+00     9.64771e+01     1.12885e-02
        65         67     1.00000e+00     9.64739e+01     4.90786e-03
        66         68     1.00000e+00     9.65042e+01     1.42514e+00
        67         70     3.51103e-01     9.64931e+01     2.98050e-01
        68         71     1.00000e+00     9.64922e+01     2.90261e-01
        69         72     1.00000e+00     9.64909e+01     2.78425e-01
        70         73     1.00000e+00     9.64747e+01     2.60804e-02
        71         74     1.00000e+00     9.64749e+01     3.33771e-01
        72         75     1.00000e+00     9.64743e+01     6.85909e-02
        73         76     1.00000e+00     9.64743e+01     2.21552e-02
        74         77     1.00000e+00     9.64743e+01     2.21105e-02
        75         78     1.00000e+00     9.64740e+01     1.92039e-02
        76         79     1.00000e+00     9.64732e+01     1.92765e-02
        77         80     1.00000e+00     9.64971e+01     2.19911e+00
        78         81     1.00000e+00     9.64731e+01     7.41184e-03
        79         82     1.00000e+00     9.64731e+01     7.27849e-03
        80         83     1.00000e+00     9.64731e+01     7.11299e-03
        81         84     1.00000e+00     9.64731e+01     6.07841e-03
        82         85     1.00000e+00     9.64730e+01     1.56453e-02
        83         86     1.00000e+00     9.64730e+01     1.34407e-02
        84         87     1.00000e+00     9.64730e+01     5.52810e-03
        85         88     1.00000e+00     9.64730e+01     5.51596e-03
        86         89     1.00000e+00     9.64729e+01     3.03490e-03
        87         90     1.00000e+00     9.64729e+01     5.35730e-02
        88         91     1.00000e+00     9.64729e+01     6.27923e-02
        89         92     1.00000e+00     9.64729e+01     7.47734e-03
        90         93     1.00000e+00     9.64729e+01     7.30216e-03
        91         94     1.00000e+00     9.64729e+01     2.94256e-03
        92         95     1.00000e+00     9.64729e+01     2.93527e-03
        93         96     1.00000e+00     9.64729e+01     2.93509e-03
        94         97     1.00000e+00     9.64729e+01     2.93491e-03
        95         98     1.00000e+00     9.64729e+01     2.93474e-03
        96         99     1.00000e+00     9.64720e+01     1.10897e-03
        97        101     1.55103e-03     9.64720e+01     6.83446e-03
        98        102     1.00000e+00     9.64720e+01     1.37859e-03
        99        103     1.00000e+00     9.64720e+01     1.10757e-03
       100        104     1.00000e+00     9.64720e+01     1.10754e-03
Reached Maximum Number of Iterations
quantile: 0.50 optimizer: pr
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          3     2.33094e-02     1.04857e+02     1.51024e+01
         2          5     5.84635e-01     1.03473e+02     4.74425e+00
         3          7     6.08608e+00     1.02432e+02     1.20853e+01
         4          9     1.26889e+00     1.00937e+02     1.77933e+01
         5         12     2.38068e+00     9.81523e+01     4.34888e+00
         6         14     2.32293e+00     9.74424e+01     5.37411e+00
         7         16     2.86376e+00     9.70849e+01     3.64786e+00
         8         18     1.66828e+00     9.67922e+01     1.34224e+00
         9         21     3.00264e+00     9.66184e+01     1.76400e+00
        10         23     2.27194e+00     9.65830e+01     7.57132e-01
        11         25     3.44917e+00     9.65707e+01     1.67671e+00
        12         27     5.50500e+00     9.65439e+01     2.56138e-01
        13         29     1.57801e+00     9.65397e+01     1.92758e-01
        14         31     1.41179e+00     9.65395e+01     2.29986e-02
        15         33     1.25031e+00     9.65394e+01     5.60206e-03
        16         35     2.77598e+00     9.65394e+01     1.80085e-02
        17         37     1.14317e+00     9.65394e+01     2.94711e-02
        18         40     2.93851e+00     9.65394e+01     2.85570e-02
        19         43     2.91079e+00     9.65393e+01     1.05636e-02
        20         45     1.25779e+00     9.65393e+01     8.03771e-04
        21         48     2.53272e+00     9.65393e+01     7.93171e-03
        22         51     1.81120e+00     9.65393e+01     1.01480e-02
        23         54     2.11769e+00     9.65393e+01     1.03094e-03
        24         56     1.31907e+00     9.65393e+01     2.90014e-03
        25         68     1.18586e+00     9.65393e+01     8.78943e-04
        26         74     1.01000e+00     9.65393e+01     1.85857e-04
        27         81     1.94974e-03     9.65393e+01     1.88120e-04
Function Value changing by less than progTol
quantile: 0.50 optimizer: lbfgs
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     6.17183e-03     1.55420e+02     6.19401e+01
         2          4     5.82408e-01     1.08041e+02     1.23584e+01
         3          5     1.00000e+00     1.05931e+02     8.20072e+00
         4          6     1.00000e+00     1.02529e+02     3.73801e+00
         5          7     1.00000e+00     1.00527e+02     3.17895e+00
         6          8     1.00000e+00     9.80487e+01     1.05528e+00
         7          9     1.00000e+00     9.74705e+01     6.90801e-01
         8         10     1.00000e+00     9.65854e+01     1.38450e+00
         9         11     1.00000e+00     9.65292e+01     6.57691e-01
        10         12     1.00000e+00     9.65050e+01     6.42260e-01
        11         13     1.00000e+00     9.64948e+01     5.78589e-02
        12         14     1.00000e+00     9.64941e+01     3.90742e-02
        13         15     1.00000e+00     9.64934e+01     5.85095e-02
        14         16     1.00000e+00     9.64910e+01     1.18587e-01
        15         17     1.00000e+00     9.64871e+01     1.63207e-01
        16         18     1.00000e+00     9.64818e+01     1.63787e-01
        17         19     1.00000e+00     9.64767e+01     1.70035e-01
        18         20     1.00000e+00     9.64745e+01     1.04333e-02
        19         21     1.00000e+00     9.64734e+01     8.07110e-02
        20         22     1.00000e+00     9.64724e+01     7.58496e-02
        21         23     1.00000e+00     9.64719e+01     1.58770e-02
        22         24     1.00000e+00     9.64717e+01     1.36590e-02
        23         25     1.00000e+00     9.64716e+01     1.90326e-02
        24         26     1.00000e+00     9.64715e+01     1.19538e-02
        25         27     1.00000e+00     9.64714e+01     1.43122e-03
        26         28     1.00000e+00     9.64714e+01     3.51587e-03
        27         29     1.00000e+00     9.64714e+01     3.61837e-03
        28         30     1.00000e+00     9.64714e+01     5.11524e-03
        29         31     1.00000e+00     9.64714e+01     4.40726e-04
        30         32     1.00000e+00     9.64714e+01     1.82942e-03
        31         33     1.00000e+00     9.64714e+01     9.05067e-04
        32         34     1.00000e+00     9.64714e+01     4.15190e-05
        33         35     1.00000e+00     9.64714e+01     3.48084e-04
        34         36     1.00000e+00     9.64714e+01     2.46681e-04
        35         37     1.00000e+00     9.64714e+01     6.14380e-05
        36         38     1.00000e+00     9.64714e+01     4.70879e-05
        37         39     1.00000e+00     9.64714e+01     6.31733e-05
        38         40     1.00000e+00     9.64714e+01     2.64957e-05
        39         41     1.00000e+00     9.64714e+01     2.52759e-06
Optimality Condition below optTol
Elapsed time is 14.681366 seconds.
quantile: 0.75 optimizer: sd
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     5.40028e-03     1.78894e+02     7.08629e+01
         2          3     1.80864e-02     1.08774e+02     7.83323e+00
Warning: Inference method failed [Error using likALD (line 74)
check] .. attempting to continue 
Warning: Inference method failed [Error using likALD (line 74)
check] .. attempting to continue 
         3          7     4.74505e-02     1.06481e+02     1.53259e+01
         4          8     1.72564e-02     1.05540e+02     1.08778e+01
         5          9     1.31725e-02     1.04593e+02     4.49730e+00
         6         10     6.63796e-02     1.04098e+02     1.24895e+01
         7         11     5.83712e-03     1.03340e+02     6.04552e+00
         8         13     1.41668e-02     1.02981e+02     3.31268e+00
         9         14     4.22304e-02     1.02709e+02     6.58110e+00
        10         15     1.05526e-02     1.02394e+02     2.52009e+00
        11         16     8.44526e-02     1.01911e+02     1.15316e+00
        12         17     4.30905e-01     1.01614e+02     1.16189e+00
        13         19     1.52301e-02     1.01599e+02     6.10017e-01
        14         20     3.19960e-02     1.01585e+02     1.18232e+00
        15         21     1.41554e-02     1.01571e+02     5.83577e-01
        16         22     3.73291e-02     1.01557e+02     1.19052e+00
        17         23     1.47997e-02     1.01544e+02     5.49831e-01
        18         24     3.44672e-02     1.01534e+02     1.24916e+00
        19         25     1.01685e-02     1.01521e+02     5.05664e-01
        20         27     4.28011e-01     1.01415e+02     6.27710e-01
        21         29     1.67668e-02     1.01409e+02     4.03103e-01
        22         30     2.87978e-02     1.01405e+02     7.42528e-01
        23         31     1.12883e-02     1.01400e+02     3.07934e-01
        24         32     5.99168e-02     1.01394e+02     4.03651e-01
        25         34     1.52099e-02     1.01392e+02     2.65477e-01
        26         35     3.19819e-02     1.01390e+02     4.25624e-01
        27         36     1.34379e-02     1.01389e+02     2.48391e-01
        28         37     4.15695e-02     1.01387e+02     4.19759e-01
        29         38     1.52375e-02     1.01385e+02     2.30680e-01
        30         39     3.12651e-02     1.01384e+02     4.30890e-01
        31         40     7.91084e-03     1.01383e+02     2.19995e-01
        32         41     4.42104e-02     1.01381e+02     3.17868e-01
        33         42     2.26294e-02     1.01381e+02     3.88323e-01
        34         43     7.80522e-03     1.01380e+02     2.02881e-01
        35         44     4.19546e-02     1.01378e+02     2.80713e-01
        36         45     2.33337e-02     1.01378e+02     3.62398e-01
        37         46     7.56575e-03     1.01377e+02     1.88702e-01
        38         47     3.97660e-02     1.01376e+02     2.68274e-01
        39         48     2.09922e-02     1.01375e+02     2.84369e-01
        40         49     1.17929e-02     1.01374e+02     1.76279e-01
        41         50     4.58974e-02     1.01373e+02     1.68422e-01
        42         52     2.22793e-02     1.01372e+02     1.85610e-01
        43         53     1.91965e-02     1.01372e+02     1.64245e-01
        44         54     2.14025e-02     1.01371e+02     1.80066e-01
        45         55     1.88380e-02     1.01370e+02     1.56235e-01
        46         56     2.21728e-02     1.01370e+02     1.79115e-01
        47         57     1.82519e-02     1.01369e+02     1.50617e-01
        48         58     2.31931e-02     1.01369e+02     1.80135e-01
        49         59     1.74864e-02     1.01368e+02     1.45183e-01
        50         60     2.46907e-02     1.01368e+02     1.83019e-01
        51         61     1.66385e-02     1.01368e+02     1.39894e-01
        52         62     2.67230e-02     1.01367e+02     1.87112e-01
        53         63     1.58714e-02     1.01367e+02     1.34643e-01
        54         64     2.89633e-02     1.01366e+02     1.91481e-01
        55         65     1.51210e-02     1.01366e+02     1.29415e-01
        56         66     3.18053e-02     1.01365e+02     1.95638e-01
        57         67     1.46442e-02     1.01365e+02     1.24215e-01
        58         68     3.40581e-02     1.01365e+02     1.99428e-01
        59         69     1.37990e-02     1.01364e+02     1.19005e-01
        60         70     3.90291e-02     1.01364e+02     1.98363e-01
        61         71     1.49234e-02     1.01364e+02     1.13317e-01
        62         72     3.31905e-02     1.01363e+02     2.06502e-01
        63         73     9.71281e-03     1.01363e+02     1.09297e-01
        64         75     5.37844e-01     1.01359e+02     5.21736e-01
        65         77     1.03045e-02     1.01358e+02     5.70734e-02
        66         78     8.01504e-01     1.01357e+02     5.26895e-01
        67         79     3.03933e-03     1.01357e+02     3.69227e-01
        68         80     1.05138e-02     1.01356e+02     1.88875e-02
        69         82     3.51072e-02     1.01356e+02     2.89479e-02
        70         83     1.52655e-02     1.01356e+02     1.77409e-02
        71         84     3.18435e-02     1.01356e+02     3.04401e-02
        72         85     1.03023e-02     1.01356e+02     1.68616e-02
        73         87     5.34506e-01     1.01356e+02     1.61186e-02
        74         89     1.58931e-02     1.01356e+02     9.00127e-03
        75         90     3.02896e-02     1.01356e+02     1.75560e-02
        76         91     1.32049e-02     1.01356e+02     7.47926e-03
        77         92     4.47569e-02     1.01356e+02     1.75127e-02
        78         93     1.45336e-02     1.01356e+02     7.48047e-03
        79         94     3.69212e-02     1.01356e+02     1.95097e-02
        80         95     4.83064e-03     1.01356e+02     1.02655e-02
        81         96     2.00176e-02     1.01356e+02     9.86748e-03
        82         97     1.70291e-02     1.01356e+02     7.18696e-03
        83         98     2.56596e-02     1.01356e+02     1.00159e-02
        84         99     1.59907e-02     1.01356e+02     7.00546e-03
        85        100     2.86476e-02     1.01356e+02     1.02795e-02
        86        101     1.53783e-02     1.01356e+02     6.80492e-03
        87        102     3.04984e-02     1.01356e+02     1.03865e-02
        88        103     1.46498e-02     1.01356e+02     6.58544e-03
        89        104     3.41373e-02     1.01356e+02     1.06314e-02
        90        105     1.41575e-02     1.01356e+02     6.34723e-03
        91        106     3.73707e-02     1.01356e+02     1.09740e-02
        92        107     1.35034e-02     1.01356e+02     6.09385e-03
        93        108     4.16617e-02     1.01356e+02     1.09601e-02
        94        109     1.39380e-02     1.01356e+02     5.82012e-03
        95        110     3.95495e-02     1.01356e+02     1.15201e-02
        96        111     9.98449e-03     1.01356e+02     5.59691e-03
        97        113     5.79335e-01     1.01356e+02     1.36486e-02
        98        115     1.06732e-02     1.01356e+02     2.85857e-03
        99        116     2.34604e-01     1.01356e+02     1.38719e-02
       100        117     8.17898e-03     1.01356e+02     2.74758e-03
Reached Maximum Number of Iterations
quantile: 0.75 optimizer: bb
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     5.40027e-03     1.78894e+02     7.08628e+01
         2          3     1.00000e+00     1.27226e+02     4.43535e+01
         3          4     1.00000e+00     1.18336e+02     5.32641e+01
         4          5     1.00000e+00     1.07823e+02     1.36758e+01
         5          6     1.00000e+00     1.06375e+02     5.90345e+00
         6          7     1.00000e+00     1.05841e+02     5.52407e+00
         7          8     1.00000e+00     1.05344e+02     5.11017e+00
         8          9     1.00000e+00     1.03165e+02     3.48014e+00
         9         10     1.00000e+00     1.02675e+02     1.22830e+01
        10         11     1.00000e+00     1.02256e+02     9.65064e+00
        11         12     1.00000e+00     1.01799e+02     7.92410e-01
        12         13     1.00000e+00     1.01785e+02     7.86905e-01
        13         14     1.00000e+00     1.01772e+02     7.79588e-01
        14         15     1.00000e+00     1.01633e+02     6.83578e-01
        15         16     1.00000e+00     1.01512e+02     6.26566e-01
        16         17     1.00000e+00     1.01637e+02     5.38262e+00
        17         18     1.00000e+00     1.01482e+02     4.63671e-01
        18         19     1.00000e+00     1.01479e+02     4.59721e-01
        19         20     1.00000e+00     1.01464e+02     4.31414e-01
        20         21     1.00000e+00     1.01357e+02     1.01421e-01
        21         22     1.00000e+00     1.01874e+02     9.63618e+00
        22         23     1.00000e+00     1.01366e+02     3.26538e-01
        23         24     1.00000e+00     1.01364e+02     3.05361e-01
        24         25     1.00000e+00     1.01363e+02     2.83733e-01
        25         26     1.00000e+00     1.01357e+02     1.09746e-01
        26         27     1.00000e+00     1.01356e+02     1.21267e-01
        27         28     1.00000e+00     1.01358e+02     5.63958e-01
        28         29     1.00000e+00     1.01356e+02     3.59588e-02
        29         30     1.00000e+00     1.01356e+02     3.49199e-02
        30         31     1.00000e+00     1.01356e+02     2.87519e-02
        31         32     1.00000e+00     1.01356e+02     1.62000e-03
        32         33     1.00000e+00     1.01356e+02     2.36957e-02
        33         34     1.00000e+00     1.01356e+02     1.28073e-02
        34         35     1.00000e+00     1.01356e+02     2.05351e-03
        35         36     1.00000e+00     1.01356e+02     1.88179e-03
        36         37     1.00000e+00     1.01356e+02     3.58422e-05
Directional Derivative below progTol
quantile: 0.75 optimizer: pr
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          4     2.19745e-02     1.07350e+02     6.98986e+00
         2          6     8.02049e-01     1.06353e+02     6.31044e+00
         3          7     1.00000e+00     1.05655e+02     1.41125e+01
         4         10     1.06044e+00     1.04220e+02     1.92585e+01
         5         12     3.89367e-01     1.03509e+02     1.52656e+01
         6         14     1.08845e+00     1.02044e+02     2.48930e+00
         7         16     1.81405e+00     1.01800e+02     7.74593e-01
         8         18     3.40655e+00     1.01638e+02     8.01166e-01
         9         20     1.52311e+00     1.01480e+02     9.00880e-01
        10         22     1.28128e+00     1.01389e+02     3.03078e-01
        11         23     1.00000e+00     1.01359e+02     1.54830e-01
        12         24     1.00000e+00     1.01356e+02     2.95219e-02
        13         26     1.26977e+00     1.01356e+02     7.28547e-03
        14         27     1.00000e+00     1.01356e+02     1.06940e-03
        15         28     1.00000e+00     1.01356e+02     8.35389e-05
Directional Derivative below progTol
quantile: 0.75 optimizer: lbfgs
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2     5.40031e-03     1.78893e+02     7.08626e+01
         2          3     1.00000e+00     1.19336e+02     5.49275e+01
         3          4     1.00000e+00     1.11354e+02     2.15271e+01
         4          5     1.00000e+00     1.07662e+02     6.83894e+00
         5          6     1.00000e+00     1.06570e+02     6.03574e+00
         6          7     1.00000e+00     1.05364e+02     7.84883e+00
         7          8     1.00000e+00     1.02629e+02     6.68289e+00
         8          9     1.00000e+00     1.01768e+02     1.32267e+00
         9         10     1.00000e+00     1.01689e+02     5.84976e-01
        10         12     6.15957e-01     1.01589e+02     1.02853e+00
        11         13     1.00000e+00     1.01539e+02     9.26998e-01
        12         14     1.00000e+00     1.01357e+02     1.07468e-01
        13         15     1.00000e+00     1.01356e+02     5.29987e-02
        14         16     1.00000e+00     1.01356e+02     6.11221e-03
        15         17     1.00000e+00     1.01356e+02     4.91127e-03
        16         18     1.00000e+00     1.01356e+02     1.79896e-03
        17         19     1.00000e+00     1.01356e+02     8.82328e-04
        18         20     1.00000e+00     1.01356e+02     1.68892e-04
Directional Derivative below progTol
Elapsed time is 10.033442 seconds.
</pre><img vspace="5" hspace="5" src="solution_06.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="solution_07.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="solution_08.png" style="width:560px;height:420px;" alt=""> <h2 id="4">Implement chosen method on full data set</h2><pre class="codeinput">clear;
load(<span class="string">'../data/data_BHP2.mat'</span>);
y=log_q;
x1=log_p;
x2=log_y;

len=10;
optimizer=<span class="string">'pr'</span>;

<span class="comment">%note: this takes many hours to run</span>
train=false;

<span class="keyword">if</span> train

    tic;
    <span class="comment">%ticBytes(gcp);</span>

    <span class="keyword">for</span> ido = 1:numel(quantiles)
        quantileToPredict = quantiles(ido);
        [~,~,~,~,~,~]=save_quantile(quantileToPredict,len,optimizer,x1,x2,y);
    <span class="keyword">end</span>

    <span class="comment">%tocBytes(gcp);</span>
    toc;

<span class="keyword">end</span>
</pre><h2 id="5">Visualize quantiles of gasoline demand</h2><pre class="codeinput">clear;
load(<span class="string">'../data/data_BHP2.mat'</span>);
y=log_q;
x1=log_p;
x2=log_y;

load(<span class="string">'../data/results_0.25_10_pr.mat'</span>);
plot_quantile(x1,x2,y,x1_test,x2_test,fmu_block,fs2_block);
title(<span class="string">'tau=0.25'</span>);

load(<span class="string">'../data/results_0.5_10_pr.mat'</span>);
plot_quantile(x1,x2,y,x1_test,x2_test,fmu_block,fs2_block);
title(<span class="string">'tau=0.50'</span>);

load(<span class="string">'../data/results_0.75_10_pr.mat'</span>);
plot_quantile(x1,x2,y,x1_test,x2_test,fmu_block,fs2_block);
title(<span class="string">'tau=0.75'</span>);
</pre><img vspace="5" hspace="5" src="solution_09.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="solution_10.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="solution_11.png" style="width:560px;height:420px;" alt=""> <p>=============================  Subfunctions =============================</p><h2 id="8">loss_vis.m</h2><p>visualize different loss functions</p><pre class="language-matlab">
e=linspace(-1,1,51);
l1=abs(e);
l2=e.^2;

e_neg=e;
e_neg(e_neg&gt;=0)=0;
e_neg(e_neg&lt;0)=1;

rho1=e.*(0.25-e_neg);
rho2=e.*(0.5-e_neg);
rho3=e.*(0.75-e_neg);

figure;
plot(e,l1);
hold <span class="string">on</span>;
plot(e,l2);
hold <span class="string">off</span>;
legend(<span class="string">'L1'</span>,<span class="string">'L2'</span>,<span class="string">'Location'</span>,<span class="string">'southeast'</span>);
title(<span class="string">'L_1 and L_2 loss'</span>);

figure;
plot(e,rho1);
hold <span class="string">on</span>;
plot(e,rho2);
plot(e,rho3);
hold <span class="string">off</span>;
legend(<span class="string">'tau=0.25'</span>,<span class="string">'tau=0.5'</span>,<span class="string">'tau=0.75'</span>,<span class="string">'Location'</span>,<span class="string">'southeast'</span>);
title(<span class="string">'Tilted loss'</span>);

</pre><h2 id="10">prelim.m</h2><p>visualize mean gasoline demand</p><pre class="language-matlab">
clear;
load(<span class="string">'../data/data_BHP2.mat'</span>);

x1 = log_p;
x2 = log_y;    <span class="comment">% Contains NaN data</span>
y = log_q;

X = [ones(size(x1)) x1 x2];
b = regress(y,X);    <span class="comment">% Removes NaN data</span>

figure;
scatter3(x1,x2,y,<span class="string">'filled'</span>)
hold <span class="string">on</span>
x1fit = linspace(min(x1),max(x1),10);
x2fit = linspace(min(x2),max(x2),10);
[X1FIT,X2FIT] = meshgrid(x1fit,x2fit);
YFIT = b(1) + b(2)*X1FIT + b(3)*X2FIT;
mesh(X1FIT,X2FIT,YFIT)
xlabel(<span class="string">'log(Price)'</span>)
ylabel(<span class="string">'log(Income)'</span>)
zlabel(<span class="string">'log(Demand)'</span>)
view(50,10)
hold <span class="string">off</span>

<span class="comment">%%%%%%%%%%%%%%%%%%</span>

X = [ones(size(x1)) x1];
b = regress(y,X);    <span class="comment">% Removes NaN data</span>

figure;
scatter(x1,y,<span class="string">'filled'</span>)
hold <span class="string">on</span>
y_hat = b(1) + b(2)*x1fit;
plot(x1fit,y_hat)
xlabel(<span class="string">'log(Price)'</span>)
ylabel(<span class="string">'log(Demand)'</span>)
hold <span class="string">off</span>

<span class="comment">%%%%%%%%%%%%%%</span>

X = [ones(size(x2)) x2];
b = regress(y,X);    <span class="comment">% Removes NaN data</span>

figure;
scatter(x2,y,<span class="string">'filled'</span>)
hold <span class="string">on</span>
y_hat = b(1) + b(2)*x2fit;
plot(x2fit,y_hat)
xlabel(<span class="string">'log(Income)'</span>)
ylabel(<span class="string">'log(Demand)'</span>)
hold <span class="string">off</span>

</pre><h2 id="12">save_quantile.m</h2><p>train site parameters, tune hyperparameters, and save output</p><pre class="language-matlab">
<span class="keyword">function</span> [x1_test,x2_test,fmu_block,fs2_block,hyp,output]=save_quantile(quantileToPredict,len,optimizer,x1,x2,y)
<span class="comment">%SAVE_QUANTILE runs the main algorithm to train site parameters and tune</span>
<span class="comment">%hyperparameters. </span>

<span class="comment">%It takes the following arguments:</span>
<span class="comment">%'quantileToPredict' quantile of interest</span>
<span class="comment">%'len' number of max permitted line searches</span>
<span class="comment">%'optimizer' string indicating which optimization algo to use</span>
<span class="comment">%'x1' vector of first components of training inputs</span>
<span class="comment">%'x2' vector of second components of training inputs</span>
<span class="comment">%'y' vector of training outputs</span>

<span class="comment">%It saves the following objects in a .mat file in the data</span>
<span class="comment">%folder:</span>
<span class="comment">%'x1_test' vector of first components of the test inputs</span>
<span class="comment">%'x2_test' vector of second components of the test inputs</span>
<span class="comment">%'fmu_block' matrix of predicted latent quantile demand at test points</span>
<span class="comment">%'fs2_block' matrix of variances of those predictions</span>
<span class="comment">%'hyp' struct of tuned hyperparameters</span>
<span class="comment">%'fX' function value at solution</span>
<span class="comment">%'i' number of line searches</span>
<span class="comment">%'output'  struct of optimization information, including path of</span>
<span class="comment">%hyperparamter optimization</span>

XTrain=[x1 x2];
YTrain=y;

likfunc = @likALD; 
hyp.lik = [log(1) quantileToPredict];
covfunc = {<span class="string">'covSEard'</span>}; 
hyp.cov = [0; 0; 0;]; <span class="comment">% Use sq exponential ARD covariance function</span>

<span class="keyword">if</span> strcmp(optimizer,<span class="string">'wr'</span>)
    [hyp fX param_path i] = minimize_vis(hyp, @gp, len, @infEP, [], covfunc, likfunc, XTrain, YTrain); <span class="comment">% maximum likelihood</span>
    output = param_path;
<span class="keyword">elseif</span> strcmp(optimizer,<span class="string">'sd'</span>)
    options=struct(<span class="string">'MaxIter'</span>, len,<span class="string">'Method'</span>,<span class="string">'sd'</span>);
    [hyp, fX, i, exitflag, output] = minimize_minfunc_vis(hyp, @gp, options, @infEP, [], covfunc, likfunc, XTrain, YTrain);
<span class="keyword">elseif</span> strcmp(optimizer,<span class="string">'bb'</span>)
    options=struct(<span class="string">'MaxIter'</span>, len,<span class="string">'Method'</span>,<span class="string">'bb'</span>);
    [hyp, fX, i, exitflag, output] = minimize_minfunc_vis(hyp, @gp, options, @infEP, [], covfunc, likfunc, XTrain, YTrain);
<span class="keyword">elseif</span> strcmp(optimizer,<span class="string">'fr'</span>)
    options=struct(<span class="string">'MaxIter'</span>, len,<span class="string">'Method'</span>,<span class="string">'pcg'</span>,<span class="string">'cgUpdate'</span>,0);
    [hyp, fX, i, exitflag, output] = minimize_minfunc_vis(hyp, @gp, options, @infEP, [], covfunc, likfunc, XTrain, YTrain);
<span class="keyword">elseif</span> strcmp(optimizer,<span class="string">'pr'</span>)
    options=struct(<span class="string">'MaxIter'</span>, len,<span class="string">'Method'</span>,<span class="string">'pcg'</span>);
    [hyp, fX, i, exitflag, output] = minimize_minfunc_vis(hyp, @gp, options, @infEP, [], covfunc, likfunc, XTrain, YTrain);
<span class="keyword">elseif</span> strcmp(optimizer,<span class="string">'bfgs'</span>)
    options=struct(<span class="string">'MaxIter'</span>, len,<span class="string">'Method'</span>,<span class="string">'qnewton'</span>,<span class="string">'qnUpdate'</span>,0);
    [hyp, fX, i, exitflag, output] = minimize_minfunc_vis(hyp, @gp, options, @infEP, [], covfunc, likfunc, XTrain, YTrain);
<span class="keyword">elseif</span> strcmp(optimizer,<span class="string">'lbfgs'</span>)
    options=struct(<span class="string">'MaxIter'</span>, len,<span class="string">'Method'</span>,<span class="string">'lbfgs'</span>);
    [hyp, fX, i, exitflag, output] = minimize_minfunc_vis(hyp, @gp, options, @infEP, [], covfunc, likfunc, XTrain, YTrain);
<span class="keyword">elseif</span> strcmp(optimizer,<span class="string">'sr1'</span>)
    options=struct(<span class="string">'MaxIter'</span>, len,<span class="string">'Method'</span>,<span class="string">'qnewton'</span>,<span class="string">'qnUpdate'</span>,1);
    [hyp, fX, i, exitflag, output] = minimize_minfunc_vis(hyp, @gp, options, @infEP, [], covfunc, likfunc, XTrain, YTrain);
<span class="keyword">else</span>
    fprintf(<span class="string">'invalid optimizer \n'</span>);
<span class="keyword">end</span>

n_test=100;
x1_test=linspace(min(x1),max(x1),n_test)';
x2_test=linspace(min(x2),max(x2),n_test)';

x1_stretch=repmat(x1_test,1,n_test)';
x1_stretch=x1_stretch(:);

x2_stretch=repmat(x2_test,n_test,1);

XTest=[x1_stretch x2_stretch];

[ymu, ys2, fmu, fs2] = gp(hyp, @infEP, [], covfunc, likfunc, XTrain, YTrain, XTest);

fmu_block=vec2mat(fmu,n_test);
fs2_block=vec2mat(fs2,n_test);

save(strcat(<span class="string">'../data/results_'</span>,num2str(quantileToPredict,2),<span class="string">'_'</span>,num2str(len),<span class="string">'_'</span>,optimizer,<span class="string">'.mat'</span>), <span class="keyword">...</span>
    <span class="string">'x1_test'</span>,<span class="string">'x2_test'</span>,<span class="string">'fmu_block'</span>,<span class="string">'fs2_block'</span>,<span class="string">'hyp'</span>,<span class="string">'fX'</span>,<span class="string">'i'</span>,<span class="string">'output'</span>)

<span class="keyword">end</span>


</pre><h2 id="14">plot_quantile.m</h2><p>visualize quantile gasoline demand with credible interval</p><pre class="language-matlab">
<span class="keyword">function</span> plot_quantile(x1,x2,y,x1_test,x2_test,fmu_block,fs2_block)
<span class="comment">%PLOT_QUANTILE generates figures for section 5.2</span>

CI_top=fmu_block+2.*sqrt(fs2_block);
CI_bottom=fmu_block-2.*sqrt(fs2_block);

figure;
scatter3(x1,x2,y,<span class="string">'filled'</span>);
hold <span class="string">on</span>;
mesh(x1_test,x2_test,fmu_block);
mesh(x1_test,x2_test,CI_top);
mesh(x1_test,x2_test,CI_bottom);
xlabel(<span class="string">'log(Price)'</span>);
ylabel(<span class="string">'log(Income)'</span>);
zlabel(<span class="string">'log(Demand)'</span>);
view(30,10);
hold <span class="string">off</span>;

<span class="keyword">end</span>


</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Visualize tilted loss
clear;
loss_vis;

%% Visualize mean gasoline demand
prelim;

%% Compare optimization methods on subset of data
clear;
startup;
load('../data/data_BHP2.mat');
data=[log_q log_p log_y];

n_obs=100;
rng(3);
sample=datasample(data,n_obs,'Replace',false);
y=sample(:,1);
x1=sample(:,2);
x2=sample(:,3);

len=100;
quantiles = [0.25 0.50 0.75];
optimizers = {'sd','bb','pr','lbfgs'};

for idq = 1:length(quantiles)
    
    quantileToPredict=quantiles(idq);
    
    tic;
    
    figure;
    for ido = 1:length(optimizers)
        
        optimizer=optimizers{ido};
        fprintf('quantile: %3.2f optimizer: %s\n',quantileToPredict,optimizer);
        
        [~,~,~,~,~,output]=save_quantile(quantileToPredict,len,optimizer,x1,x2,y);
        
        param_path=output.trace.param_path;
        n_iter=output.iterations;

        subplot(2,2,ido);
        scatter3(param_path(1,:),param_path(2,:),param_path(4,:),'filled');
        line(param_path(1,:),param_path(2,:),param_path(4,:));
        title(strcat(optimizers{ido},': ',num2str(n_iter)));
        xlabel('log(\theta_{price})');
        ylabel('log(\theta_{income})');
        zlabel('log(\sigma)');
        view(30,30);
        
    end
    
    toc;
    
end


%% Implement chosen method on full data set

clear;
load('../data/data_BHP2.mat');
y=log_q;
x1=log_p;
x2=log_y;

len=10;
optimizer='pr';

%note: this takes many hours to run
train=false;

if train

    tic;
    %ticBytes(gcp);
    
    for ido = 1:numel(quantiles)
        quantileToPredict = quantiles(ido);
        [~,~,~,~,~,~]=save_quantile(quantileToPredict,len,optimizer,x1,x2,y);
    end
    
    %tocBytes(gcp);
    toc;

end

%% Visualize quantiles of gasoline demand

clear;
load('../data/data_BHP2.mat');
y=log_q;
x1=log_p;
x2=log_y;

load('../data/results_0.25_10_pr.mat');
plot_quantile(x1,x2,y,x1_test,x2_test,fmu_block,fs2_block);
title('tau=0.25');

load('../data/results_0.5_10_pr.mat');
plot_quantile(x1,x2,y,x1_test,x2_test,fmu_block,fs2_block);
title('tau=0.50');

load('../data/results_0.75_10_pr.mat');
plot_quantile(x1,x2,y,x1_test,x2_test,fmu_block,fs2_block);
title('tau=0.75');

%%
% =============================
%  Subfunctions
% =============================
%%

%% loss_vis.m
% visualize different loss functions
%
% <include>loss_vis.m</include>
%
%%

%% prelim.m
% visualize mean gasoline demand
%
% <include>prelim.m</include>
%
%%

%% save_quantile.m
% train site parameters, tune hyperparameters, and save output
%
% <include>save_quantile.m</include>
%
%%

%% plot_quantile.m
% visualize quantile gasoline demand with credible interval
%
% <include>plot_quantile.m</include>
%
%%
##### SOURCE END #####
--></body></html>